pipeline {
  agent any

  stages {
    stage('Generate JSON') {
      steps {
        script {
          def raw = sh(script: 'python3 python/generate_payload.py', returnStdout: true).trim()
          if (!raw) {
            error('Python stdout が空です。')
          }

          new groovy.json.JsonSlurperClassic().parseText(raw)
          echo raw
          currentBuild.description = raw
        }
      }
    }
  }
}
